# 🧪 AI Deep Integration (v0.1-v0.3) 功能测试指南

## ✅ 启动检查

### 查看日志确认功能已启用

从您的日志中可以看到：
```
✓ 运行态上下文已初始化
✓ 模型加载成功: BAAI/bge-small-zh-v1.5
✓ Embedding 模型预加载完成
✓ asset_manager 逻辑层已连接到 AI助手
✓ config_tool 逻辑层已连接到 AI助手
```

**说明：所有 v0.1-v0.3 功能已成功启用！** 🎉

---

## 📋 测试清单

### 🔹 v0.1 功能测试（只读检索）

#### **测试1：语义意图解析**

**步骤**：
1. 切换到 **AI助手** 模块
2. 依次输入以下查询，观察AI的响应

**测试用例**：
```
# 资产查询意图
1. "查找所有材质资产"
2. "项目里有哪些场景资源？"
3. "显示我的人物模型"

# 配置查询意图
4. "查看当前的配置设置"
5. "DefaultEngine.ini 里有什么内容？"

# 日志分析意图
6. "最近有什么错误日志吗？"
7. "分析一下启动日志"

# 文档搜索意图
8. "如何使用资产管理器？"
9. "配置工具的功能介绍"

# 闲聊意图
10. "你好"
11. "今天天气怎么样"
```

**预期结果**：
- AI应能正确识别每个查询的意图类型
- 响应应该包含意图分析信息（如果启用了调试模式）

---

#### **测试2：运行态上下文追踪**

**步骤**：
1. 在主窗口切换到 **资产管理器** 模块
2. 随机选择一个资产（例如：某个场景或人物）
3. 切换回 **AI助手** 模块
4. 提问：`"我刚才选择的是什么资产？"`

**预期结果**：
- AI应该能识别您刚才选中的资产
- 响应应该包含资产的名称和相关信息

**额外测试**：
```
5. 切换到 **配置工具** 模块
6. 切换回 AI助手
7. 提问："我现在在哪个模块？"
```

**预期结果**：
- AI应回答"配置工具"或相关信息

---

#### **测试3：本地文档检索**

**步骤**：
1. 在 **AI助手** 中提问文档相关问题
2. 观察响应是否包含来自本地文档的信息

**测试用例**：
```
1. "模块管理器是做什么的？"
2. "如何创建新模块？"
3. "配置管理系统有什么特性？"
4. "资产缩略图怎么生成？"
```

**预期结果**：
- AI响应应包含来自项目文档的准确信息
- 如果启用了源标签，应显示信息来源

---

#### **测试4：远程代码搜索**

**步骤**：
1. 在 `resources/templates/global_settings.json` 中配置 GitHub Token（如果有）
2. 或在环境变量中设置 `GITHUB_TOKEN`
3. 提问代码相关问题

**测试用例**：
```
1. "这个项目的核心架构是什么？"
2. "模块加载流程是怎样的？"
```

**预期结果**：
- 如果配置了 Token，AI可以搜索 GitHub 代码库
- 如果没有 Token，会回退到本地检索

---

### 🔹 v0.2 功能测试（工具调用）

#### **测试5：资产查询工具**

**步骤**：
1. 在 **AI助手** 中提问资产相关问题

**测试用例**：
```
1. "帮我搜索所有场景类型的资产"
2. "查找名称包含'character'的资产"
3. "显示物品分类下的所有资产"
```

**预期结果**：
- AI应自动调用 `search_assets` 工具
- 响应应包含工具调用记录和实际搜索结果
- 结果应以结构化格式展示

---

#### **测试6：配置查询工具**

**步骤**：
1. 确保 **配置工具** 模块有配置文件
2. 在 **AI助手** 中提问配置相关问题

**测试用例**：
```
1. "查找所有引擎相关的配置"
2. "搜索包含'Resolution'的配置项"
```

**预期结果**：
- AI应自动调用 `search_configs` 工具
- 返回匹配的配置项列表

---

#### **测试7：日志搜索工具**

**测试用例**：
```
1. "搜索最近的错误日志"
2. "查找包含'WARNING'的日志"
3. "最近有什么异常吗？"
```

**预期结果**：
- AI应自动调用 `search_logs` 工具
- 返回相关日志条目

---

#### **测试8：文档搜索工具**

**测试用例**：
```
1. "搜索关于'模块开发'的文档"
2. "查找'配置管理'相关说明"
```

**预期结果**：
- AI应自动调用 `search_docs` 工具
- 返回相关文档片段

---

#### **测试9：多工具协作**

**测试用例**（复杂查询）：
```
1. "我想了解一下当前项目有哪些场景资产，以及如何配置场景加载"
```

**预期结果**：
- AI应该依次调用多个工具：
  - `search_assets` (type="场景")
  - `search_docs` ("场景加载配置")
- 最终整合所有工具结果给出综合回答

---

### 🔹 v0.3 功能测试（受控操作）

#### **测试10：导出配置模板（需确认）**

**步骤**：
1. 在 **AI助手** 中请求导出操作

**测试用例**：
```
1. "帮我导出一个引擎配置模板"
2. "生成 DefaultGame.ini 的配置模板"
```

**预期结果**：
- AI识别为受控操作
- **弹出确认对话框**，显示：
  - 工具名称：`export_config_template`
  - 参数：配置文件名
  - 预览：模板内容摘要
- 您可以选择：
  - ✅ **确认** → 执行操作并写入审计日志
  - ❌ **取消** → 操作取消，记录取消事件

---

#### **测试11：批量重命名预览（需确认）**

**测试用例**：
```
1. "帮我预览批量重命名：将所有'Test_'开头的资产改为'Demo_'开头"
```

**预期结果**：
- 弹出确认对话框，显示：
  - 工具名称：`batch_rename_preview`
  - 参数：原始模式、新模式
  - 预览：受影响的资产列表
- 用户确认后执行

---

#### **测试12：审计日志查看**

**步骤**：
1. 执行几次受控操作（确认或取消都可以）
2. 打开审计日志文件查看

**日志位置**：
```
C:\Users\wang\AppData\Roaming\ue_toolkit\logs\tool_audit.log
```

**预期内容**：
```json
{
  "timestamp": "2025-11-04 14:30:15",
  "tool_name": "export_config_template",
  "arguments": {"template_name": "DefaultEngine"},
  "preview": "模板内容...",
  "user_confirmed": true,
  "result": "success"
}
```

---

## 🔍 调试模式测试

### 启用调试模式

**修改配置**（可选）：
```json
// resources/templates/global_settings.json
{
  "debug_mode": true,
  "ai_context_debug": true
}
```

**预期效果**：
- AI响应会包含更详细的调试信息：
  - 意图分析详情
  - 运行态上下文快照
  - 检索证据来源
  - 工具调用参数
  - 执行耗时统计

---

## 📊 性能测试

### 响应速度测试

**测试简单查询响应时间**：
```
1. "你好" → 应在 1-2 秒内响应
2. "查找资产" → 应在 2-3 秒内响应（含工具调用）
3. "复杂分析查询" → 应在 5-8 秒内响应（多工具协作）
```

### 模型加载测试

- ✅ 首次启动：模型应在 30-60 秒内预加载完成
- ✅ 后续启动：应使用缓存，5-10 秒内完成

---

## ⚠️ 已知限制和注意事项

### 1. 运行态上下文
- **范围**：仅追踪 AI助手、资产管理器、配置工具
- **持久化**：保存在用户数据目录，应用重启后恢复

### 2. 本地文档检索
- **索引范围**：`docs/`、模块 `README.md`、配置模板
- **更新机制**：首次启动时全量索引，增量更新在 v0.2（未完全实现）

### 3. 远程代码搜索
- **需要 Token**：GitHub API 限流严格，建议配置 Token
- **回退机制**：无 Token 时自动降级到本地检索

### 4. 工具调用
- **只读工具**：无需确认，立即执行
- **受控工具**：必须用户确认，记录审计日志

### 5. 审计日志
- **存储位置**：`user_logs_dir/tool_audit.log`
- **格式**：JSON Lines（每行一个 JSON 对象）
- **清理**：需手动清理或实现日志轮转

---

## 📝 测试报告模板

完成测试后，您可以按以下格式记录结果：

```markdown
## v0.1 测试结果

- [x] 语义意图解析：✅ 10/10 通过
- [x] 运行态上下文：✅ 正常追踪
- [x] 本地文档检索：✅ 准确返回
- [ ] 远程代码搜索：⏳ 未配置 Token

## v0.2 测试结果

- [x] 资产查询工具：✅ 调用成功
- [x] 配置查询工具：✅ 正常工作
- [x] 日志搜索工具：✅ 结果准确
- [x] 文档搜索工具：✅ 检索正常
- [x] 多工具协作：✅ 整合良好

## v0.3 测试结果

- [x] 确认对话框：✅ 正常弹出
- [x] 导出配置模板：✅ 执行成功
- [x] 批量重命名预览：✅ 预览准确
- [x] 审计日志：✅ 记录完整

## 性能表现

- 简单查询响应：< 2秒 ✅
- 工具调用查询：< 3秒 ✅
- 复杂协作查询：< 8秒 ✅
- 模型加载时间：35秒 ✅

## 发现的问题

（记录测试中发现的任何问题）

1. ...
2. ...
```

---

## 🎯 快速测试脚本

**推荐测试顺序**（5分钟快速验证）：

```
1. 打开 AI助手
2. 输入："你好，介绍一下你自己"
   → 验证基础对话功能

3. 输入："查找所有场景资产"
   → 验证意图识别 + 工具调用

4. 切换到资产管理器，选择一个资产
5. 切换回AI助手
6. 输入："我刚才选的是什么？"
   → 验证运行态上下文

7. 输入："帮我导出一个配置模板"
   → 验证受控操作 + 确认对话框

8. 查看审计日志文件
   → 验证日志记录
```

**如果以上8步都通过，说明 v0.1-v0.3 功能完整可用！** ✅

---

**祝测试顺利！** 🎉

如遇到问题，请查看：
- `AI_Deep_Integration_完成总结.md` - 完整功能说明
- `v0.1_验收文档.md` - v0.1 详细验收标准
- `v0.2_验收文档.md` - v0.2 详细验收标准
- `v0.3_验收文档.md` - v0.3 详细验收标准

