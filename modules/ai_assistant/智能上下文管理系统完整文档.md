# ğŸš€ æ™ºèƒ½ä¸Šä¸‹æ–‡ç®¡ç†ç³»ç»Ÿ - å®Œæ•´æ–‡æ¡£

> åŸºäº Mem0 è®¾è®¡ç†å¿µçš„å®Œæ•´ä¸Šä¸‹æ–‡ç®¡ç†è§£å†³æ–¹æ¡ˆ

---

## ğŸ“‹ ç›®å½•

1. [æ¦‚è§ˆ](#æ¦‚è§ˆ)
2. [å¿«é€Ÿå¼€å§‹](#å¿«é€Ÿå¼€å§‹)
3. [æ ¸å¿ƒæ¦‚å¿µ](#æ ¸å¿ƒæ¦‚å¿µ)
4. [ç³»ç»Ÿæ¶æ„](#ç³»ç»Ÿæ¶æ„)
5. [è®°å¿†ä¿å­˜æœºåˆ¶](#è®°å¿†ä¿å­˜æœºåˆ¶)
6. [ä½¿ç”¨æŒ‡å—](#ä½¿ç”¨æŒ‡å—)
7. [API å‚è€ƒ](#api-å‚è€ƒ)
8. [é…ç½®è°ƒæ•´](#é…ç½®è°ƒæ•´)
9. [æ•…éšœæ’æŸ¥](#æ•…éšœæ’æŸ¥)
10. [æ‰©å±•æ–¹å‘](#æ‰©å±•æ–¹å‘)

---

## æ¦‚è§ˆ

### âœ¨ æ ¸å¿ƒèƒ½åŠ›

ä½ çš„ AI åŠ©æ‰‹ç°åœ¨å…·å¤‡ä¸‰å¤§æ ¸å¿ƒèƒ½åŠ›ï¼š

1. **è®°å¿†**ï¼šè®°ä½å†å²å¯¹è¯å’Œç”¨æˆ·åå¥½
2. **ç†è§£**ï¼šæ™ºèƒ½åˆ†ææŸ¥è¯¢æ„å›¾ï¼ŒåŠ¨æ€åŠ è½½æ•°æ®
3. **å­¦ä¹ **ï¼šä»æ—¥å¿—è‡ªåŠ¨å­¦ä¹ é”™è¯¯æ¨¡å¼

### ğŸ¯ å…³é”®ç‰¹æ€§

- âœ… å¤šçº§è®°å¿†ç®¡ç†ï¼ˆç”¨æˆ·/ä¼šè¯/ä¸Šä¸‹æ–‡ï¼‰
- âœ… æ™ºèƒ½ä¸Šä¸‹æ–‡èåˆï¼ˆ7 å±‚è‡ªåŠ¨èåˆï¼‰
- âœ… ä¸Šä¸‹æ–‡ä¼˜åŒ–å’Œå»é‡
- âœ… ä»æ—¥å¿—è‡ªåŠ¨å­¦ä¹ 
- âœ… æŒä¹…åŒ–å­˜å‚¨
- âœ… æ¨¡å—åŒ–æ¶æ„ï¼ˆä¾¿äºæ‰©å±•ï¼‰

---

## å¿«é€Ÿå¼€å§‹

### æ­¥éª¤ 1: å¯åŠ¨ç¨‹åº

```bash
python main.py
```

### æ­¥éª¤ 2: æ‰“å¼€ AI åŠ©æ‰‹æ¨¡å—

åœ¨ä¸»ç•Œé¢ä¸­é€‰æ‹© "AI åŠ©æ‰‹" æ¨¡å—

### æ­¥éª¤ 3: å¼€å§‹å¯¹è¯

ç›´æ¥å¯¹è¯å³å¯ï¼ç³»ç»Ÿä¼šè‡ªåŠ¨ï¼š
- è®°ä½ä½ çš„åå¥½
- æ£€ç´¢ç›¸å…³è®°å¿†
- æ³¨å…¥å½“å‰ç¨‹åºçŠ¶æ€

### ğŸ’¬ å®ç”¨ç¤ºä¾‹

**è®© AI è®°ä½åå¥½ï¼š**
```
ä½ : "æˆ‘å–œæ¬¢ä½¿ç”¨ Lumen å…¨å±€å…‰ç…§"
AI: "å¥½çš„ï¼Œæˆ‘å·²ç»è®°ä½äº†ã€‚"

[é‡å¯ç¨‹åºå]

ä½ : "æˆ‘å¹³æ—¶ç”¨ä»€ä¹ˆå…‰ç…§ï¼Ÿ"
AI: "ä½ å–œæ¬¢ä½¿ç”¨ Lumen å…¨å±€å…‰ç…§ã€‚"
```

**å¼•ç”¨å†å²å¯¹è¯ï¼š**
```
ä½ : "æ˜¾ç¤ºæ‰€æœ‰è“å›¾èµ„äº§"
AI: [åˆ—å‡ºè“å›¾åˆ—è¡¨]

ä½ : "ç¬¬ä¸‰ä¸ªçš„è·¯å¾„æ˜¯ä»€ä¹ˆï¼Ÿ"
AI: [æ ¹æ®ä¹‹å‰çš„å¯¹è¯ä¸Šä¸‹æ–‡ï¼Œç›´æ¥å›ç­”]
```

**è‡ªåŠ¨æ’æŸ¥é—®é¢˜ï¼š**
```
ä½ : "ç¨‹åºå¯åŠ¨å¾ˆæ…¢ï¼Œæ€ä¹ˆå›äº‹ï¼Ÿ"
AI: [è‡ªåŠ¨æ£€æŸ¥æ—¥å¿—] â†’ [åˆ†æé”™è¯¯] â†’ [æä¾›æ–¹æ¡ˆ]
```

---

## æ ¸å¿ƒæ¦‚å¿µ

### 1. å¤šçº§è®°å¿†ç³»ç»Ÿ

```
ç”¨æˆ·çº§è®°å¿†ï¼ˆUSERï¼‰
â”œâ”€ å­˜å‚¨ä½ç½®ï¼šç£ç›˜ï¼ˆJSON æ–‡ä»¶ï¼‰
â”œâ”€ ç”Ÿå‘½å‘¨æœŸï¼šæ°¸ä¹…ä¿å­˜ï¼ˆé‡å¯ä¸ä¸¢å¤±ï¼‰
â””â”€ å…¸å‹å†…å®¹ï¼šç”¨æˆ·åå¥½ã€é‡è¦é”™è¯¯ã€å­¦ä¹ åˆ°çš„çŸ¥è¯†

ä¼šè¯çº§è®°å¿†ï¼ˆSESSIONï¼‰
â”œâ”€ å­˜å‚¨ä½ç½®ï¼šå†…å­˜ï¼ˆPython åˆ—è¡¨ï¼‰
â”œâ”€ ç”Ÿå‘½å‘¨æœŸï¼šç¨‹åºé€€å‡ºå³æ¸…é™¤
â””â”€ å…¸å‹å†…å®¹ï¼šå½“å‰ä¼šè¯çš„å¯¹è¯å†å²

ä¸Šä¸‹æ–‡ç¼“å†²ï¼ˆCONTEXTï¼‰
â”œâ”€ å­˜å‚¨ä½ç½®ï¼šå†…å­˜é˜Ÿåˆ—ï¼ˆdequeï¼Œæœ€å¤š10æ¡ï¼‰
â”œâ”€ ç”Ÿå‘½å‘¨æœŸï¼šæ»šåŠ¨æ›´æ–°ï¼ˆè¶…å‡ºå®¹é‡è‡ªåŠ¨ä¸¢å¼ƒï¼‰
â””â”€ å…¸å‹å†…å®¹ï¼šæœ€è¿‘10è½®å¯¹è¯
```

### 2. 7 å±‚æ™ºèƒ½ä¸Šä¸‹æ–‡èåˆ

æ¯æ¬¡å¯¹è¯æ—¶ï¼ŒAI è‡ªåŠ¨èåˆï¼š

```
ç¬¬ä¸€å±‚ï¼šç³»ç»Ÿæç¤ºè¯ï¼ˆå®šä¹‰ AI è§’è‰²ï¼‰
   â†“
ç¬¬äºŒå±‚ï¼šç”¨æˆ·ç”»åƒï¼ˆä»è®°å¿†æå–ä¸ªæ€§åŒ–ä¿¡æ¯ï¼‰
   â†“
ç¬¬ä¸‰å±‚ï¼šç›¸å…³å†å²è®°å¿†ï¼ˆæ™ºèƒ½æ£€ç´¢ç›¸å…³å†…å®¹ï¼‰
   â†“
ç¬¬å››å±‚ï¼šæœ€è¿‘å¯¹è¯ä¸Šä¸‹æ–‡ï¼ˆä¿æŒå¯¹è¯è¿è´¯æ€§ï¼‰
   â†“
ç¬¬äº”å±‚ï¼šè¿è¡Œæ—¶çŠ¶æ€ï¼ˆUE å·¥å…·ç®±å½“å‰çŠ¶æ€ï¼‰
   â†“
ç¬¬å…­å±‚ï¼šé¢†åŸŸç‰¹å®šä¸Šä¸‹æ–‡ï¼ˆèµ„äº§/é…ç½®/æ—¥å¿—/æ–‡æ¡£ï¼‰
   â†“
ç¬¬ä¸ƒå±‚ï¼šæ™ºèƒ½å›é€€ï¼ˆæ— å…³é”®è¯æ—¶çš„å…œåº•ç­–ç•¥ï¼‰
```

### 3. ä¸Šä¸‹æ–‡ä¼˜åŒ–å’Œå»é‡

- æŒ‰ä¼˜å…ˆçº§æ’åºä¸Šä¸‹æ–‡ç»„ä»¶
- è‡ªåŠ¨å»é™¤é‡å¤ä¿¡æ¯
- æ™ºèƒ½æˆªæ–­è¿‡é•¿å†…å®¹ï¼ˆæœ€å¤§ 8000 å­—ç¬¦ï¼‰
- é¿å…è¶…å‡º API token é™åˆ¶

---

## ç³»ç»Ÿæ¶æ„

### æ¨¡å—å…³ç³»å›¾

```
ChatWindow (UIå±‚)
    â†“
ContextManager (ä¸Šä¸‹æ–‡ç®¡ç†)
    â†“
EnhancedMemoryManager (è®°å¿†ç®¡ç†)
    â”œâ”€â”€ ConversationMemory (å¯¹è¯å†å²)
    â”œâ”€â”€ ç”¨æˆ·çº§è®°å¿† (æŒä¹…åŒ–å­˜å‚¨)
    â”œâ”€â”€ ä¼šè¯çº§è®°å¿† (ä¸´æ—¶å­˜å‚¨)
    â””â”€â”€ ä¸Šä¸‹æ–‡çº§è®°å¿† (å•æ¬¡æŸ¥è¯¢)
    
ContextManager è¿˜è¿æ¥ï¼š
    â”œâ”€â†’ AssetReader (èµ„äº§æ•°æ®)
    â”œâ”€â†’ ConfigReader (é…ç½®æ•°æ®)
    â”œâ”€â†’ LogAnalyzer (æ—¥å¿—æ•°æ®)
    â””â”€â†’ DocumentReader (æ–‡æ¡£æ•°æ®)
```

### æ•°æ®æµ

```
ç”¨æˆ·è¾“å…¥æŸ¥è¯¢
    â†“
ContextManager.build_context()
    â”œâ”€â”€ è¯»å–ç”¨æˆ·ç”»åƒ
    â”œâ”€â”€ æ™ºèƒ½æ£€ç´¢ç›¸å…³è®°å¿†
    â”œâ”€â”€ åŠ è½½è¿è¡Œæ—¶çŠ¶æ€
    â””â”€â”€ æ ¹æ®æ„å›¾åŠ è½½é¢†åŸŸæ•°æ®
    â†“
ä¼˜åŒ–å’Œå»é‡ï¼ˆ_optimize_contextï¼‰
    â†“
å‘é€åˆ° API
    â†“
æ¥æ”¶ AI å›å¤
    â†“
ä¿å­˜åˆ°è®°å¿†
    â”œâ”€â”€ add_dialogue() â†’ ä¼šè¯çº§è®°å¿†
    â””â”€â”€ add_memory() â†’ ç”¨æˆ·çº§è®°å¿†ï¼ˆå¦‚æœé‡è¦ï¼‰
```

---

## è®°å¿†ä¿å­˜æœºåˆ¶

### ä¿å­˜æ—¶æœºå’Œè§¦å‘æ¡ä»¶

#### 1. å¯¹è¯å®Œæˆåï¼ˆè‡ªåŠ¨ï¼‰

**è§¦å‘ä½ç½®**ï¼š`ChatWindow.on_request_finished()`

```python
ç”¨æˆ·å‘é€æ¶ˆæ¯
    â†“
AI å›å¤å®Œæˆ
    â†“
ChatWindow.on_request_finished()
    â†“
context_manager.memory.add_dialogue(user_msg, ai_msg)
    â†“
ä¿å­˜åˆ° session_memoriesï¼ˆä¼šè¯çº§ï¼Œå†…å­˜ï¼‰
ä¿å­˜åˆ° context_bufferï¼ˆä¸Šä¸‹æ–‡çº§ï¼Œå†…å­˜é˜Ÿåˆ—ï¼‰
```

#### 2. æ£€æµ‹åˆ°ç”¨æˆ·åå¥½æ—¶ï¼ˆè‡ªåŠ¨ï¼‰

**è§¦å‘æ¡ä»¶**ï¼šç”¨æˆ·æ¶ˆæ¯åŒ…å«å…³é”®è¯

**å…³é”®è¯åˆ—è¡¨**ï¼š`['å–œæ¬¢', 'å¸¸ç”¨', 'åå¥½', 'ä¹ æƒ¯']`

```python
ç”¨æˆ·è¯´ï¼š"æˆ‘å–œæ¬¢ä½¿ç”¨ Lumen å…‰ç…§"
    â†“
ChatWindow æ£€æµ‹åˆ° "å–œæ¬¢" å…³é”®è¯
    â†“
memory.add_memory(
    content="ç”¨æˆ·åå¥½: ä½¿ç”¨ Lumen å…‰ç…§",
    level=MemoryLevel.USER,    # ç”¨æˆ·çº§ï¼ŒæŒä¹…åŒ–
    metadata={'type': 'preference'},
    auto_evaluate=True
)
    â†“
ä¿å­˜åˆ° user_memoriesï¼ˆç”¨æˆ·çº§ï¼Œå†…å­˜ï¼‰
è°ƒç”¨ _save_user_memories() å†™å…¥ JSON æ–‡ä»¶
```

#### 3. ä»æ—¥å¿—å­¦ä¹ æ—¶ï¼ˆæ‰‹åŠ¨/è‡ªåŠ¨ï¼‰

```python
è°ƒç”¨ sync_from_log()
    â†“
LogAnalyzer.analyze_errors()  # åˆ†ææ—¥å¿—
    â†“
æå–é”™è¯¯æ¨¡å¼
    â†“
memory.add_memory(
    content="ç³»ç»Ÿé”™è¯¯: ...",
    level=MemoryLevel.USER,    # æŒä¹…åŒ–
    metadata={'type': 'error_log', 'source': 'auto_learn'},
    auto_evaluate=True
)
    â†“
ä¿å­˜åˆ° user_memories
å†™å…¥ JSON æ–‡ä»¶
```

#### 4. ç¨‹åºé€€å‡ºæ—¶ï¼ˆè‡ªåŠ¨ï¼‰

```python
ç¨‹åºæ­£å¸¸é€€å‡º
    â†“
__del__() æˆ–æ˜¾å¼è°ƒç”¨ save()
    â†“
_save_user_memories()
    â†“
å°† user_memories å†™å…¥ JSON æ–‡ä»¶
```

### æ–‡ä»¶å­˜å‚¨æ ¼å¼

**ä¿å­˜ä½ç½®ï¼š**

- Windows: `C:\Users\{ç”¨æˆ·å}\AppData\Local\UE_Toolkit\ai_memory\default_memory.json`
- macOS: `~/Library/Application Support/UE_Toolkit/ai_memory/default_memory.json`
- Linux: `~/.local/share/UE_Toolkit/ai_memory/default_memory.json`

**JSON æ ¼å¼ï¼š**

```json
{
  "user_id": "default",
  "created_at": "2025-11-03T10:30:00",
  "last_updated": "2025-11-03T15:45:00",
  "memories": [
    {
      "content": "ç”¨æˆ·åå¥½ï¼šå–œæ¬¢ä½¿ç”¨ Lumen å…¨å±€å…‰ç…§",
      "level": "user",
      "timestamp": "2025-11-03T10:30:15",
      "metadata": {
        "type": "preference",
        "importance": 0.8,
        "source": "conversation"
      }
    }
  ]
}
```

---

## ä½¿ç”¨æŒ‡å—

### æ–¹å¼ 1: å¸¸è§„å¯¹è¯ï¼ˆæ¨èï¼‰

ç”¨æˆ·åªéœ€æ­£å¸¸å¯¹è¯ï¼ŒAI ä¼šè‡ªåŠ¨ï¼š
1. æ£€ç´¢ç›¸å…³å†å²è®°å¿†
2. æ³¨å…¥å½“å‰ç¨‹åºçŠ¶æ€
3. æ ¹æ®æŸ¥è¯¢æ„å›¾åŠ è½½å¯¹åº”æ•°æ®

**æ— éœ€ä»»ä½•ç‰¹æ®Šæ“ä½œï¼**

### æ–¹å¼ 2: æ‰‹åŠ¨è§¦å‘æ—¥å¿—å­¦ä¹ 

å¦‚æœç¨‹åºé‡åˆ°é”™è¯¯ï¼Œå¯ä»¥æ‰‹åŠ¨è§¦å‘å­¦ä¹ ï¼š

```python
# åœ¨ ChatWindow æˆ–å…¶ä»–åœ°æ–¹è°ƒç”¨
self.context_manager.sync_from_log(auto_learn=True)
```

### æ–¹å¼ 3: æŸ¥çœ‹è®°å¿†å†…å®¹

å¯ä»¥ç›´æ¥æŸ¥è¯¢ AI åŠ©æ‰‹ï¼š

```
ç”¨æˆ·: "ä½ è®°å¾—æˆ‘ä¹‹å‰è¯´è¿‡ä»€ä¹ˆå—ï¼Ÿ"
AI: [æ£€ç´¢ç”¨æˆ·çº§å’Œä¼šè¯çº§è®°å¿†] â†’ åˆ—å‡ºç›¸å…³å†…å®¹

ç”¨æˆ·: "æˆ‘ä¹‹å‰é‡åˆ°è¿‡ä»€ä¹ˆé”™è¯¯ï¼Ÿ"
AI: [æ£€ç´¢é”™è¯¯æ—¥å¿—è®°å¿†] â†’ åˆ—å‡ºå†å²é”™è¯¯
```

### æœ€ä½³å®è·µ

#### 1. è§¦å‘æŒä¹…åŒ–ä¿å­˜

**æ¨èåšæ³•**ï¼šæ˜ç¡®è¡¨è¾¾åå¥½

```
âœ… "æˆ‘å–œæ¬¢ä½¿ç”¨ Lumen å…¨å±€å…‰ç…§"        â†’ è‡ªåŠ¨ä¿å­˜
âœ… "æˆ‘ä¹ æƒ¯ä½¿ç”¨ Forward Rendering"    â†’ è‡ªåŠ¨ä¿å­˜
âŒ "Lumen æŒºå¥½çš„"                    â†’ ä¸ä¼šä¿å­˜ï¼ˆæ— å…³é”®è¯ï¼‰
```

#### 2. è‡ªç„¶å¯¹è¯

ä¸éœ€è¦ä½¿ç”¨ç‰¹å®šå…³é”®è¯ï¼ŒAI ä¼šè‡ªåŠ¨ç†è§£ä½ çš„æ„å›¾ã€‚

#### 3. å–„ç”¨"ä¹‹å‰"ã€"ä¸Šæ¬¡"

å¯ä»¥è¯´ "ä¹‹å‰é‚£ä¸ª..."ã€"ä¸Šæ¬¡æåˆ°çš„..." å¼•ç”¨å†å²å†…å®¹ã€‚

#### 4. é‡åˆ°é—®é¢˜ç›´æ¥é—®

è¯´ "æœ‰ä»€ä¹ˆé”™è¯¯å—ï¼Ÿ"ï¼ŒAI ä¼šè‡ªåŠ¨æ£€æŸ¥æ—¥å¿—ã€‚

---

## API å‚è€ƒ

### ContextManager

#### `build_context(query: str, include_system_prompt: bool = True) -> str`

æ„å»ºæ™ºèƒ½èåˆçš„ä¸Šä¸‹æ–‡ä¿¡æ¯

**å‚æ•°ï¼š**
- `query`: ç”¨æˆ·æŸ¥è¯¢
- `include_system_prompt`: æ˜¯å¦åŒ…å«ç³»ç»Ÿæç¤ºè¯ï¼ˆé»˜è®¤ Trueï¼‰

**è¿”å›ï¼š** ä¼˜åŒ–åçš„ä¸Šä¸‹æ–‡å­—ç¬¦ä¸²

**è°ƒç”¨æ—¶æœºï¼š** æ¯æ¬¡å‘é€æ¶ˆæ¯åˆ° API å‰è‡ªåŠ¨è°ƒç”¨

**ç¤ºä¾‹ï¼š**
```python
context = context_manager.build_context("æˆ‘çš„è“å›¾åœ¨å“ªï¼Ÿ")
```

#### `sync_from_log(auto_learn: bool = True) -> None`

ä»æ—¥å¿—è‡ªåŠ¨å­¦ä¹ ä¸Šä¸‹æ–‡

**å‚æ•°ï¼š**
- `auto_learn`: æ˜¯å¦è‡ªåŠ¨è¯„ä¼°é‡è¦æ€§ï¼ˆé»˜è®¤ Trueï¼‰

**ä½¿ç”¨åœºæ™¯ï¼š**
- ç¨‹åºå¯åŠ¨æ—¶è‡ªåŠ¨è°ƒç”¨ï¼ˆå­¦ä¹ å†å²é”™è¯¯ï¼‰
- é‡åˆ°æ–°é”™è¯¯åæ‰‹åŠ¨è°ƒç”¨
- å®šæœŸè°ƒç”¨ï¼ˆå¦‚æ¯ 5 åˆ†é’Ÿï¼‰

**ç¤ºä¾‹ï¼š**
```python
# åœ¨ç¨‹åºå¯åŠ¨æ—¶
context_manager.sync_from_log()

# é‡åˆ°é”™è¯¯å
try:
    # ... æ‰§è¡ŒæŸæ“ä½œ ...
except Exception as e:
    logger.error(f"æ“ä½œå¤±è´¥: {e}")
    context_manager.sync_from_log()  # ç«‹å³å­¦ä¹ 
```

### EnhancedMemoryManager

#### `add_dialogue(user_message: str, assistant_message: str) -> None`

ä¿å­˜ä¸€è½®å¯¹è¯åˆ°è®°å¿†

**è‡ªåŠ¨è°ƒç”¨ï¼š** ChatWindow çš„ `on_request_finished()` ä¸­è‡ªåŠ¨ä¿å­˜

**ç¤ºä¾‹ï¼š**
```python
memory.add_dialogue(
    user_message="æˆ‘çš„è“å›¾åœ¨å“ªï¼Ÿ",
    assistant_message="ä½ çš„è“å›¾åœ¨..."
)
```

#### `add_memory(content: str, level: str, metadata: Dict, auto_evaluate: bool = True) -> None`

æ·»åŠ è®°å¿†

**å‚æ•°ï¼š**
- `content`: è®°å¿†å†…å®¹
- `level`: è®°å¿†çº§åˆ«ï¼ˆ`MemoryLevel.USER` / `SESSION` / `CONTEXT`ï¼‰
- `metadata`: å…ƒæ•°æ®ï¼ˆç±»å‹ã€é‡è¦æ€§ç­‰ï¼‰
- `auto_evaluate`: æ˜¯å¦è‡ªåŠ¨è¯„ä¼°é‡è¦æ€§

**ç¤ºä¾‹ï¼š**
```python
memory.add_memory(
    content="ç”¨æˆ·åå¥½ï¼šä½¿ç”¨ Nanite è™šæ‹Ÿå‡ ä½•ä½“",
    level=MemoryLevel.USER,
    metadata={'type': 'preference'},
    auto_evaluate=True
)
```

#### `get_relevant_memories(query: str, limit: int = 3, min_importance: float = 0.4) -> List[str]`

æ™ºèƒ½æ£€ç´¢ç›¸å…³å†å²è®°å¿†

**è‡ªåŠ¨è°ƒç”¨ï¼š** `build_context()` ä¸­è‡ªåŠ¨æ£€ç´¢

**å‚æ•°ï¼š**
- `query`: æŸ¥è¯¢å­—ç¬¦ä¸²
- `limit`: è¿”å›çš„æœ€å¤§è®°å¿†æ•°é‡
- `min_importance`: æœ€å°é‡è¦æ€§é˜ˆå€¼

**è¿”å›ï¼š** ç›¸å…³è®°å¿†åˆ—è¡¨

**ç¤ºä¾‹ï¼š**
```python
memories = memory.get_relevant_memories("ä¹‹å‰çš„é…ç½®", limit=5)
```

#### `get_user_profile() -> str`

è·å–ç”¨æˆ·ç”»åƒ

**è¿”å›ï¼š** æ ¼å¼åŒ–çš„ç”¨æˆ·ä¹ æƒ¯å’Œåå¥½å­—ç¬¦ä¸²

**ç¤ºä¾‹ï¼š**
```python
profile = memory.get_user_profile()
print(profile)
```

#### `get_recent_context(limit: int = 3) -> str`

è·å–æœ€è¿‘å¯¹è¯ä¸Šä¸‹æ–‡

**å‚æ•°ï¼š**
- `limit`: è¿”å›çš„å¯¹è¯è½®æ•°

**è¿”å›ï¼š** æ ¼å¼åŒ–çš„å¯¹è¯å†å²

**ç¤ºä¾‹ï¼š**
```python
recent = memory.get_recent_context(limit=5)
```

#### `get_statistics() -> Dict`

è·å–è®°å¿†ç»Ÿè®¡ä¿¡æ¯

**è¿”å›ï¼š** åŒ…å«å„çº§è®°å¿†æ•°é‡çš„å­—å…¸

**ç¤ºä¾‹ï¼š**
```python
stats = memory.get_statistics()
print(stats)
# {'user_memories': 5, 'session_memories': 10, 'context_buffer': 3}
```

#### `clear_session() -> None`

æ¸…é™¤ä¼šè¯çº§è®°å¿†

**ç¤ºä¾‹ï¼š**
```python
memory.clear_session()
```

---

## é…ç½®è°ƒæ•´

### è°ƒæ•´è®°å¿†å®¹é‡

**æ–‡ä»¶:** `modules/ai_assistant/logic/enhanced_memory_manager.py`

```python
# æ‰¾åˆ°è¿™è¡Œ
self.context_buffer = deque(maxlen=10)

# æ”¹ä¸º
self.context_buffer = deque(maxlen=20)  # è®°ä½ 20 è½®å¯¹è¯
```

### è°ƒæ•´ä¸Šä¸‹æ–‡é•¿åº¦é™åˆ¶

**æ–‡ä»¶:** `modules/ai_assistant/logic/context_manager.py`

åœ¨ `_optimize_context()` æ–¹æ³•ä¸­ï¼š

```python
# æ‰¾åˆ°è¿™è¡Œ
max_length = 8000

# æ”¹ä¸º
max_length = 12000  # å¢åŠ ä¸Šä¸‹æ–‡é•¿åº¦
```

### è°ƒæ•´è®°å¿†æ£€ç´¢æ•°é‡

**æ–‡ä»¶:** `modules/ai_assistant/logic/context_manager.py`

åœ¨ `build_context()` æ–¹æ³•ä¸­ï¼š

```python
# æ‰¾åˆ°è¿™è¡Œ
relevant_memories = self.memory.get_relevant_memories(query, limit=3)

# æ”¹ä¸º
relevant_memories = self.memory.get_relevant_memories(query, limit=5)
```

### è°ƒæ•´é‡è¦æ€§é˜ˆå€¼

**æ–‡ä»¶:** `modules/ai_assistant/logic/context_manager.py`

```python
# æ‰¾åˆ°è¿™è¡Œ
relevant_memories = self.memory.get_relevant_memories(query, limit=3, min_importance=0.4)

# æ”¹ä¸º
relevant_memories = self.memory.get_relevant_memories(query, limit=3, min_importance=0.6)
```

---

## æ•…éšœæ’æŸ¥

### é—®é¢˜ 1: AI æ— æ³•è®°ä½ä¹‹å‰çš„å¯¹è¯

**åŸå› ï¼š** `add_dialogue()` å¯èƒ½æ²¡æœ‰è¢«è°ƒç”¨

**è§£å†³æ–¹æ¡ˆï¼š**
1. æ£€æŸ¥ `ChatWindow.on_request_finished()` æ˜¯å¦æ­£å¸¸æ‰§è¡Œ
2. æŸ¥çœ‹æ§åˆ¶å°è¾“å‡ºæ˜¯å¦æœ‰ `[DEBUG] [OK] å·²ä¿å­˜å¯¹è¯åˆ°å¢å¼ºå‹è®°å¿†ç®¡ç†å™¨`
3. ç¡®è®¤ç¨‹åºæ­£å¸¸é€€å‡ºï¼ˆè€Œä¸æ˜¯å¼ºåˆ¶å…³é—­ï¼‰

### é—®é¢˜ 2: ä¸Šä¸‹æ–‡è¿‡é•¿å¯¼è‡´ API æŠ¥é”™

**åŸå› ï¼š** ä¸Šä¸‹æ–‡è¶…å‡º API token é™åˆ¶

**è§£å†³æ–¹æ¡ˆï¼š**
1. å‡å° `max_length` é…ç½®ï¼ˆé»˜è®¤ 8000ï¼‰
2. å‡å°‘è®°å¿†æ£€ç´¢æ•°é‡ï¼ˆ`limit=3` æ”¹ä¸º `limit=2`ï¼‰
3. æé«˜é‡è¦æ€§é˜ˆå€¼ï¼ˆ`min_importance=0.4` æ”¹ä¸º `0.6`ï¼‰

### é—®é¢˜ 3: è®°å¿†æ— æ³•æŒä¹…åŒ–

**åŸå› ï¼š** ç”¨æˆ·çº§è®°å¿†æ²¡æœ‰æ­£ç¡®ä¿å­˜åˆ°æ–‡ä»¶

**è§£å†³æ–¹æ¡ˆï¼š**
1. æ£€æŸ¥ `EnhancedMemoryManager` çš„ `_save_user_memories()` æ–¹æ³•æ˜¯å¦è¢«è°ƒç”¨
2. æ£€æŸ¥æ–‡ä»¶æƒé™ï¼ˆè®°å¿†æ–‡ä»¶é»˜è®¤ä¿å­˜åœ¨ç”¨æˆ·æ•°æ®ç›®å½•ï¼‰
3. æŸ¥çœ‹æ—¥å¿—æ–‡ä»¶ä¸­çš„é”™è¯¯ä¿¡æ¯

### é—®é¢˜ 4: æ—¥å¿—å­¦ä¹ æ²¡æœ‰æ•ˆæœ

**åŸå› ï¼š** æ—¥å¿—æ–‡ä»¶è·¯å¾„ä¸æ­£ç¡®æˆ–æ— é”™è¯¯æ—¥å¿—

**è§£å†³æ–¹æ¡ˆï¼š**
1. ç¡®è®¤ `LogAnalyzer` èƒ½æ­£ç¡®è¯»å–æ—¥å¿—
2. æ‰‹åŠ¨è§¦å‘å­¦ä¹ å¹¶æŸ¥çœ‹æ—¥å¿—è¾“å‡ºï¼š
   ```python
   context_manager.sync_from_log()
   ```
3. æ£€æŸ¥æ—¥å¿—ç›®å½•æ˜¯å¦å­˜åœ¨

### è°ƒè¯•æ–¹æ³•

#### æ–¹æ³• 1: æŸ¥çœ‹è®°å¿†æ–‡ä»¶

ç›´æ¥æ‰“å¼€ JSON æ–‡ä»¶æŸ¥çœ‹ï¼š
```
Windows: %LOCALAPPDATA%\UE_Toolkit\ai_memory\default_memory.json
macOS: ~/Library/Application Support/UE_Toolkit/ai_memory/default_memory.json
Linux: ~/.local/share/UE_Toolkit/ai_memory/default_memory.json
```

#### æ–¹æ³• 2: é€šè¿‡ API æŸ¥çœ‹

```python
# åœ¨ç¨‹åºä¸­
memory = context_manager.memory

# æŸ¥çœ‹ç»Ÿè®¡
stats = memory.get_statistics()
print(stats)

# æŸ¥çœ‹æ‰€æœ‰ç”¨æˆ·çº§è®°å¿†
for mem in memory.user_memories:
    print(f"{mem.timestamp}: {mem.content}")
```

#### æ–¹æ³• 3: è¯¢é—® AI

```
ä½ ï¼šä½ è®°ä½äº†å“ªäº›å…³äºæˆ‘çš„ä¿¡æ¯ï¼Ÿ
AIï¼š[åˆ—å‡ºæ‰€æœ‰ç”¨æˆ·çº§è®°å¿†]

ä½ ï¼šæˆ‘ä»¬ä¹‹å‰èŠäº†ä»€ä¹ˆï¼Ÿ
AIï¼š[åˆ—å‡ºæœ€è¿‘çš„å¯¹è¯å†å²]
```

---

## æ‰©å±•æ–¹å‘

### å½“å‰æ¶æ„ï¼ˆç®€å•å®ç°ï¼‰

```python
EnhancedMemoryManager
    â””â”€â”€ ConversationMemory (å†…å­˜å­˜å‚¨)
```

### æœªæ¥æ‰©å±•ï¼šå‘é‡æ•°æ®åº“

å¯ä»¥è½»æ¾æ›¿æ¢ä¸ºï¼š

```python
EnhancedMemoryManager
    â””â”€â”€ ChromaDB / FAISS (å‘é‡å­˜å‚¨)
```

**æ‰©å±•æ­¥éª¤ï¼š**
1. å®‰è£…å‘é‡æ•°æ®åº“ï¼š
   ```bash
   pip install chromadb
   # æˆ–
   pip install faiss-cpu
   ```

2. ä¿®æ”¹ `EnhancedMemoryManager` çš„å­˜å‚¨åç«¯

3. ä¿æŒ API æ¥å£ä¸å˜ï¼ˆ`add_memory`, `get_relevant_memories`ï¼‰

4. æ— éœ€ä¿®æ”¹ `ContextManager` æˆ– `ChatWindow`

### å‘é‡æ£€ç´¢ç¤ºä¾‹

```python
from chromadb import Client

class VectorMemoryManager(EnhancedMemoryManager):
    def __init__(self, ...):
        super().__init__(...)
        self.vector_db = Client()
        self.collection = self.vector_db.create_collection("memories")
    
    def get_relevant_memories(self, query: str, limit: int = 5):
        # ä½¿ç”¨å‘é‡ç›¸ä¼¼åº¦æ£€ç´¢
        results = self.collection.query(
            query_texts=[query],
            n_results=limit
        )
        return results['documents'][0]
```

### çŸ­æœŸä¼˜åŒ–ï¼ˆ1-2 å‘¨ï¼‰

1. **å®šæœŸè‡ªåŠ¨å­¦ä¹ **ï¼šæ·»åŠ å®šæ—¶å™¨ï¼Œæ¯ 5 åˆ†é’Ÿè‡ªåŠ¨è°ƒç”¨ `sync_from_log()`
2. **è®°å¿†å¯è§†åŒ–**ï¼šåœ¨ UI ä¸­å±•ç¤ºå½“å‰è®°å¿†å†…å®¹
3. **æ‰‹åŠ¨è®°å¿†ç®¡ç†**ï¼šå…è®¸ç”¨æˆ·åˆ é™¤æˆ–ç¼–è¾‘è®°å¿†

### ä¸­æœŸä¼˜åŒ–ï¼ˆ1-2 æœˆï¼‰

1. **è¯­ä¹‰æœç´¢**ï¼šé›†æˆ ChromaDB æˆ– FAISS å®ç°å‘é‡æ£€ç´¢
2. **è®°å¿†é‡è¦æ€§è¯„ä¼°**ï¼šåŸºäºè®¿é—®é¢‘ç‡è‡ªåŠ¨è°ƒæ•´é‡è¦æ€§
3. **è·¨ä¼šè¯å­¦ä¹ **ï¼šåˆ†æå¤šä¸ªä¼šè¯çš„æ¨¡å¼ï¼Œæå–å…±æ€§

### é•¿æœŸä¼˜åŒ–ï¼ˆ3-6 æœˆï¼‰

1. **å¤šç”¨æˆ·æ”¯æŒ**ï¼šä¸ºä¸åŒç”¨æˆ·ç»´æŠ¤ç‹¬ç«‹è®°å¿†
2. **çŸ¥è¯†å›¾è°±**ï¼šæ„å»ºèµ„äº§ã€é…ç½®ã€æ—¥å¿—ä¹‹é—´çš„å…³è”å…³ç³»
3. **ä¸»åŠ¨æ¨è**ï¼šAI ä¸»åŠ¨æé†’ç”¨æˆ·å¸¸è§é—®é¢˜å’Œæœ€ä½³å®è·µ

---

## æ€§èƒ½æŒ‡æ ‡

| æŒ‡æ ‡ | å½“å‰å€¼ | è¯´æ˜ | å¯è°ƒæ•´ |
|------|--------|------|--------|
| å¯¹è¯å†å²å®¹é‡ | 10 è½® | ConversationMemory | âœ… |
| æœ€å¤§ä¸Šä¸‹æ–‡é•¿åº¦ | 8000 å­—ç¬¦ | é¿å…è¶…å‡º token é™åˆ¶ | âœ… |
| è®°å¿†æ£€ç´¢æ•°é‡ | 3 æ¡ | å¹³è¡¡ç›¸å…³æ€§å’Œæ•ˆç‡ | âœ… |
| æ—¥å¿—å­¦ä¹ æ•°é‡ | æœ€å¤š 5 æ¡é”™è¯¯ | é¿å…ä¿¡æ¯è¿‡è½½ | âœ… |
| è®°å¿†é‡è¦æ€§é˜ˆå€¼ | 0.4 | åªæ£€ç´¢é‡è¦è®°å¿† | âœ… |

**å­˜å‚¨å®¹é‡ï¼š**
- ç”¨æˆ·çº§ï¼šæ— é™åˆ¶ï¼ˆå»ºè®® < 1000 æ¡ï¼‰
- ä¼šè¯çº§ï¼šæ— é™åˆ¶ï¼ˆè‡ªåŠ¨å¢é•¿ï¼‰
- ä¸Šä¸‹æ–‡çº§ï¼šå›ºå®š 10 æ¡

**æ–‡ä»¶å¤§å°ä¼°ç®—ï¼š**
- å¹³å‡æ¯æ¡è®°å¿†ï¼š~200 å­—èŠ‚
- 1000 æ¡è®°å¿†ï¼š~200 KB
- å®Œå…¨å¯æ¥å—

---

## æŠ€æœ¯è®¾è®¡

### è®¾è®¡ç†å¿µï¼ˆåŸºäº Mem0ï¼‰

**å‚è€ƒæ–¹æ¡ˆï¼š**
- Mem0: å¤šçº§è®°å¿†ç³»ç»Ÿï¼ˆç”¨æˆ·çº§ã€ä¼šè¯çº§ã€ä¸Šä¸‹æ–‡çº§ï¼‰
- MemGPT: æ™ºèƒ½çš„å¤§æ¨¡å‹è®°å¿†ç®¡ç†
- VCPToolBox: äº¤å‰è®°å¿†ç½‘ç»œ

**æˆ‘ä»¬çš„å®ç°ï¼š**
- å¤šçº§è®°å¿†ç³»ç»Ÿ âœ…
- æ™ºèƒ½é‡è¦æ€§è¯„åˆ† âœ…
- æ™ºèƒ½æ£€ç´¢å’Œè¿‡æ»¤ âœ…
- æŒä¹…åŒ–å­˜å‚¨ âœ…
- ç”¨æˆ·ç”»åƒç”Ÿæˆ âœ…

### æ ¸å¿ƒä»£ç ç»“æ„

```
modules/ai_assistant/logic/
â”œâ”€â”€ context_manager.py              (ä¸Šä¸‹æ–‡ç®¡ç†å™¨)
â”‚   â”œâ”€â”€ build_context()             â†’ æ„å»ºæ™ºèƒ½ä¸Šä¸‹æ–‡
â”‚   â”œâ”€â”€ sync_from_log()             â†’ ä»æ—¥å¿—å­¦ä¹ 
â”‚   â”œâ”€â”€ _build_system_prompt()      â†’ ç³»ç»Ÿæç¤ºè¯
â”‚   â”œâ”€â”€ _build_domain_contexts()    â†’ é¢†åŸŸä¸Šä¸‹æ–‡
â”‚   â”œâ”€â”€ _optimize_context()         â†’ ä¼˜åŒ–å’Œå»é‡
â”‚   â””â”€â”€ _build_runtime_status()     â†’ è¿è¡Œæ—¶çŠ¶æ€
â”‚
â”œâ”€â”€ enhanced_memory_manager.py      (å¢å¼ºå‹è®°å¿†ç®¡ç†å™¨)
â”‚   â”œâ”€â”€ add_memory()                â†’ æ·»åŠ è®°å¿†
â”‚   â”œâ”€â”€ add_dialogue()              â†’ æ·»åŠ å¯¹è¯
â”‚   â”œâ”€â”€ get_relevant_memories()     â†’ æ™ºèƒ½æ£€ç´¢
â”‚   â”œâ”€â”€ get_user_profile()          â†’ ç”¨æˆ·ç”»åƒ
â”‚   â”œâ”€â”€ _save_user_memories()       â†’ ä¿å­˜åˆ°ç£ç›˜
â”‚   â””â”€â”€ _load_user_memories()       â†’ ä»ç£ç›˜åŠ è½½
â”‚
â””â”€â”€ conversation_memory.py          (å¯¹è¯è®°å¿†)
    â”œâ”€â”€ add_dialogue()              â†’ æ·»åŠ å¯¹è¯
    â”œâ”€â”€ get_recent_context()        â†’ è·å–æœ€è¿‘å¯¹è¯
    â””â”€â”€ has_history()               â†’ æ£€æŸ¥æ˜¯å¦æœ‰å†å²
```

---

## æ€»ç»“

### âœ… å·²å®ç°

- å¤šçº§è®°å¿†ç®¡ç†ï¼ˆUSER/SESSION/CONTEXTï¼‰
- æ™ºèƒ½ä¸Šä¸‹æ–‡èåˆï¼ˆ7 å±‚è‡ªåŠ¨èåˆï¼‰
- ä¸Šä¸‹æ–‡ä¼˜åŒ–å’Œå»é‡
- ä»æ—¥å¿—è‡ªåŠ¨å­¦ä¹ 
- æŒä¹…åŒ–å­˜å‚¨
- æ¨¡å—åŒ–æ¶æ„ï¼ˆä¾¿äºæ‰©å±•ï¼‰

### âœ… æ ¸å¿ƒä¼˜åŠ¿

- **è®°å¿†**ï¼šèƒ½è®°ä½å†å²å¯¹è¯å’Œç”¨æˆ·åå¥½
- **ç†è§£**ï¼šæ™ºèƒ½åˆ†ææŸ¥è¯¢æ„å›¾ï¼ŒåŠ¨æ€åŠ è½½æ•°æ®
- **å­¦ä¹ **ï¼šä»æ—¥å¿—è‡ªåŠ¨å­¦ä¹ é”™è¯¯æ¨¡å¼

### ğŸš€ ç°åœ¨å¼€å§‹ä½¿ç”¨

```bash
# å¯åŠ¨ç¨‹åº
python main.py

# æ‰“å¼€ AI åŠ©æ‰‹æ¨¡å—
# å¼€å§‹å¯¹è¯ï¼
```

**ä½ çš„ AI åŠ©æ‰‹ç°åœ¨çœŸæ­£å…·å¤‡äº†"è®°å¿†ã€ç†è§£ã€å­¦ä¹ "çš„èƒ½åŠ›ï¼** ğŸ‰

---

## ç›¸å…³æ–‡ä»¶

- `context_manager.py` - ä¸Šä¸‹æ–‡ç®¡ç†å™¨å®ç°
- `enhanced_memory_manager.py` - è®°å¿†ç®¡ç†å™¨å®ç°
- `conversation_memory.py` - å¯¹è¯è®°å¿†å®ç°
- `chat_window.py` - UI å±‚é›†æˆ
- `asset_reader.py` - èµ„äº§æ•°æ®è¯»å–
- `config_reader.py` - é…ç½®æ•°æ®è¯»å–
- `log_analyzer.py` - æ—¥å¿—åˆ†æ
- `document_reader.py` - æ–‡æ¡£è¯»å–

---

**æœ€åæ›´æ–°ï¼š2025-11-04**

