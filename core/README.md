# Core æ ¸å¿ƒæ¨¡å—

æœ¬ç›®å½•åŒ…å« UE Toolkit çš„æ ¸å¿ƒåŠŸèƒ½æ¨¡å—ï¼Œæä¾›åº”ç”¨ç¨‹åºçš„åŸºç¡€æ¶æ„å’Œå…¬å…±æœåŠ¡ã€‚

## ğŸ“ ç›®å½•ç»“æ„

```
core/
â”œâ”€â”€ ai_services/              # AI æœåŠ¡
â”‚   â”œâ”€â”€ embedding_service.py  # åµŒå…¥å‘é‡æœåŠ¡ï¼ˆè¯­ä¹‰æ¨¡å‹ï¼‰
â”‚   â””â”€â”€ __init__.py
â”œâ”€â”€ config/                   # é…ç½®ç®¡ç†
â”‚   â”œâ”€â”€ config_backup.py      # é…ç½®å¤‡ä»½ç®¡ç†
â”‚   â”œâ”€â”€ config_manager.py     # é…ç½®ç®¡ç†å™¨
â”‚   â”œâ”€â”€ config_validator.py   # é…ç½®éªŒè¯å™¨
â”‚   â””â”€â”€ __init__.py
â”œâ”€â”€ config_templates/         # é…ç½®æ¨¡æ¿
â”‚   â””â”€â”€ app_config_template.json  # åº”ç”¨é…ç½®æ¨¡æ¿
â”œâ”€â”€ utils/                    # å·¥å…·ç±»
â”‚   â”œâ”€â”€ custom_widgets.py     # è‡ªå®šä¹‰ UI ç»„ä»¶
â”‚   â”œâ”€â”€ file_utils.py         # æ–‡ä»¶æ“ä½œå·¥å…·
â”‚   â”œâ”€â”€ path_utils.py         # è·¯å¾„å¤„ç†å·¥å…·
â”‚   â”œâ”€â”€ performance_monitor.py # æ€§èƒ½ç›‘æ§
â”‚   â”œâ”€â”€ style_loader.py       # æ ·å¼åŠ è½½å™¨
â”‚   â”œâ”€â”€ theme_manager.py      # ä¸»é¢˜ç®¡ç†å™¨
â”‚   â”œâ”€â”€ thread_utils.py       # çº¿ç¨‹å·¥å…·
â”‚   â”œâ”€â”€ ue_process_utils.py   # UE è¿›ç¨‹å·¥å…·
â”‚   â”œâ”€â”€ validators.py         # æ•°æ®éªŒè¯å™¨
â”‚   â””â”€â”€ __init__.py
â”œâ”€â”€ app_manager.py            # åº”ç”¨ç®¡ç†å™¨
â”œâ”€â”€ base_logic.py             # é€»è¾‘å±‚åŸºç±»
â”œâ”€â”€ logger.py                 # æ—¥å¿—ç³»ç»Ÿ
â”œâ”€â”€ module_interface.py       # æ¨¡å—æ¥å£å®šä¹‰
â”œâ”€â”€ module_manager.py         # æ¨¡å—ç®¡ç†å™¨
â”œâ”€â”€ single_instance.py        # å•å®ä¾‹æ§åˆ¶
â””â”€â”€ __init__.py
```

## ğŸ”§ æ ¸å¿ƒç»„ä»¶

### 1. AI æœåŠ¡ (`ai_services/`)

- **`embedding_service.py`**: æä¾›è¯­ä¹‰åµŒå…¥å‘é‡æœåŠ¡
  - ä½¿ç”¨ `BAAI/bge-small-zh-v1.5` æ¨¡å‹
  - æ”¯æŒæ–‡æœ¬å‘é‡åŒ–ï¼ˆ512ç»´ï¼‰
  - ç”¨äº AI è®°å¿†ç³»ç»Ÿçš„è¯­ä¹‰æ£€ç´¢

### 2. é…ç½®ç®¡ç† (`config/`)

- **`config_manager.py`**: ç»Ÿä¸€é…ç½®ç®¡ç†
  - æ¨¡å—é…ç½®çš„åŠ è½½ã€ä¿å­˜ã€å‡çº§
  - æ”¯æŒé…ç½®æ¨¡æ¿å’Œç”¨æˆ·é…ç½®åˆ†ç¦»
  - è‡ªåŠ¨å¤‡ä»½æœºåˆ¶

- **`config_validator.py`**: é…ç½®éªŒè¯
  - åŸºäº JSON Schema çš„é…ç½®éªŒè¯
  - ç¡®ä¿é…ç½®æ–‡ä»¶çš„å®Œæ•´æ€§å’Œæ­£ç¡®æ€§

- **`config_backup.py`**: é…ç½®å¤‡ä»½ç®¡ç†
  - è‡ªåŠ¨åˆ›å»ºé…ç½®å¤‡ä»½
  - æ”¯æŒé…ç½®å›æ»š

### 3. å·¥å…·ç±» (`utils/`)

- **`theme_manager.py`**: ä¸»é¢˜ç®¡ç†
  - æ”¯æŒæ·±è‰²/æµ…è‰²ä¸»é¢˜åˆ‡æ¢
  - åŠ¨æ€åŠ è½½ QSS æ ·å¼
  - è‡ªå®šä¹‰ä¸»é¢˜æ”¯æŒ

- **`style_loader.py`**: æ ·å¼åŠ è½½
  - åŠ è½½å’Œåº”ç”¨ QSS æ ·å¼
  - æ”¯æŒæ ·å¼ç»„ä»¶åŒ–

- **`custom_widgets.py`**: è‡ªå®šä¹‰ç»„ä»¶
  - æ‰©å±• Qt ç»„ä»¶åŠŸèƒ½
  - æä¾›å¯å¤ç”¨çš„ UI ç»„ä»¶

- **`file_utils.py`**: æ–‡ä»¶æ“ä½œ
  - æ–‡ä»¶è¯»å†™ã€å¤åˆ¶ã€ç§»åŠ¨
  - å®‰å…¨çš„æ–‡ä»¶æ“ä½œå°è£…

- **`path_utils.py`**: è·¯å¾„å¤„ç†
  - è·¯å¾„è§„èŒƒåŒ–
  - ç›¸å¯¹è·¯å¾„å’Œç»å¯¹è·¯å¾„è½¬æ¢

- **`thread_utils.py`**: çº¿ç¨‹ç®¡ç†
  - çº¿ç¨‹æ± ç®¡ç†
  - å¼‚æ­¥ä»»åŠ¡æ‰§è¡Œ

- **`performance_monitor.py`**: æ€§èƒ½ç›‘æ§
  - æ€§èƒ½æŒ‡æ ‡æ”¶é›†
  - èµ„æºä½¿ç”¨ç›‘æ§

- **`ue_process_utils.py`**: UE è¿›ç¨‹ç®¡ç†
  - UE è¿›ç¨‹æ£€æµ‹å’Œäº¤äº’
  - é¡¹ç›®è·¯å¾„è§£æ

- **`validators.py`**: æ•°æ®éªŒè¯
  - è¾“å…¥éªŒè¯
  - æ•°æ®æ ¼å¼æ£€æŸ¥

### 4. æ ¸å¿ƒç®¡ç†å™¨

- **`app_manager.py`**: åº”ç”¨ç®¡ç†å™¨
  - åº”ç”¨ç”Ÿå‘½å‘¨æœŸç®¡ç†
  - å…¨å±€çŠ¶æ€ç®¡ç†

- **`module_manager.py`**: æ¨¡å—ç®¡ç†å™¨
  - åŠ¨æ€åŠ è½½æ¨¡å—
  - æ¨¡å—ç”Ÿå‘½å‘¨æœŸç®¡ç†
  - æ¨¡å—é—´é€šä¿¡

- **`logger.py`**: æ—¥å¿—ç³»ç»Ÿ
  - ç»Ÿä¸€æ—¥å¿—è®°å½•
  - æ”¯æŒå¤šçº§åˆ«æ—¥å¿—
  - æ—¥å¿—æ–‡ä»¶ç®¡ç†

- **`single_instance.py`**: å•å®ä¾‹æ§åˆ¶
  - é˜²æ­¢åº”ç”¨é‡å¤å¯åŠ¨
  - è¿›ç¨‹é—´é€šä¿¡

- **`base_logic.py`**: é€»è¾‘å±‚åŸºç±»
  - æä¾›é€»è¾‘å±‚çš„é€šç”¨åŠŸèƒ½
  - æ ‡å‡†åŒ–é€»è¾‘å±‚æ¥å£

- **`module_interface.py`**: æ¨¡å—æ¥å£
  - å®šä¹‰æ¨¡å—æ ‡å‡†æ¥å£
  - è§„èŒƒæ¨¡å—å¼€å‘

## ğŸš€ ä½¿ç”¨ç¤ºä¾‹

### é…ç½®ç®¡ç†

```python
from core.config.config_manager import ConfigManager

# åˆ›å»ºé…ç½®ç®¡ç†å™¨
config_manager = ConfigManager(
    module_name="my_module",
    template_path=template_path,
    config_schema=schema
)

# è·å–é…ç½®
config = config_manager.get_module_config()

# ä¿å­˜é…ç½®
config_manager.save_config(new_config)
```

### ä¸»é¢˜ç®¡ç†

```python
from core.utils.theme_manager import ThemeManager

# è·å–ä¸»é¢˜ç®¡ç†å™¨å®ä¾‹
theme_manager = ThemeManager.instance()

# åˆ‡æ¢ä¸»é¢˜
theme_manager.set_theme("dark")

# è·å–å½“å‰ä¸»é¢˜
current_theme = theme_manager.get_current_theme()
```

### æ—¥å¿—è®°å½•

```python
from core.logger import get_logger

# è·å–æ—¥å¿—è®°å½•å™¨
logger = get_logger(__name__)

# è®°å½•æ—¥å¿—
logger.info("åº”ç”¨å¯åŠ¨æˆåŠŸ")
logger.warning("é…ç½®æ–‡ä»¶ä¸å­˜åœ¨ï¼Œä½¿ç”¨é»˜è®¤é…ç½®")
logger.error("å¤„ç†å¤±è´¥", exc_info=True)
```

## ğŸ“ å¼€å‘æŒ‡å—

### æ·»åŠ æ–°çš„æ ¸å¿ƒåŠŸèƒ½

1. åœ¨ `utils/` ç›®å½•ä¸‹åˆ›å»ºæ–°çš„å·¥å…·ç±»
2. éµå¾ªç°æœ‰çš„ä»£ç é£æ ¼å’Œå‘½åè§„èŒƒ
3. æ·»åŠ å®Œæ•´çš„æ–‡æ¡£å­—ç¬¦ä¸²
4. ç¡®ä¿çº¿ç¨‹å®‰å…¨ï¼ˆå¦‚æœéœ€è¦ï¼‰
5. ç¼–å†™å•å…ƒæµ‹è¯•ï¼ˆå»ºè®®ï¼‰

### ä¿®æ”¹é…ç½®ç³»ç»Ÿ

1. æ›´æ–°é…ç½®æ¨¡æ¿ (`config_templates/`)
2. æ›´æ–° JSON Schemaï¼ˆå¦‚æœéœ€è¦ï¼‰
3. æ·»åŠ é…ç½®å‡çº§é€»è¾‘ï¼ˆå¦‚æœéœ€è¦ï¼‰
4. æµ‹è¯•é…ç½®åŠ è½½å’Œä¿å­˜

## âš ï¸ æ³¨æ„äº‹é¡¹

- **é…ç½®å¤‡ä»½**: ä¿®æ”¹é…ç½®å‰ä¼šè‡ªåŠ¨åˆ›å»ºå¤‡ä»½
- **å•ä¾‹æ¨¡å¼**: éƒ¨åˆ†ç®¡ç†å™¨ä½¿ç”¨å•ä¾‹æ¨¡å¼ï¼Œæ³¨æ„çº¿ç¨‹å®‰å…¨
- **æ—¥å¿—çº§åˆ«**: ç”Ÿäº§ç¯å¢ƒå»ºè®®ä½¿ç”¨ INFO çº§åˆ«
- **æ€§èƒ½ç›‘æ§**: æ€§èƒ½ç›‘æ§å¯èƒ½å½±å“æ€§èƒ½ï¼Œè°¨æ…ä½¿ç”¨

## ğŸ”— ç›¸å…³æ–‡æ¡£

- [é…ç½®ç³»ç»Ÿè¯´æ˜](../docs/configuration.md)
- [æ¨¡å—å¼€å‘æŒ‡å—](../docs/module_development.md)
- [æ—¥å¿—ç³»ç»Ÿè¯´æ˜](../docs/logging.md)

